import sys
import json
import datetime
from collections import defaultdict
from typing import Dict
from urllib.request import urlopen
from urllib.parse import quote
from bs4 import BeautifulSoup
from html import escape

##########################################################

class Record:
    def __init__(self, mode: str, faction: str, user_uuid: str, map_id: str):
        self.mode = mode
        self.faction = faction
        self.user_uuid = user_uuid
        self.map_id = map_id
        self.wins = 0
        self.loss = 0

    def as_key(self):
        return self.mode + '!' + self.faction + '!' + self.user_uuid + '!' + self.map_id

    def serialize(self):
        return [self.faction, self.user_uuid, self.map_id, self.wins, self.loss]


def gather_user_names(gamemode: str, arena: str) -> Dict[str, str]:
    html = urlopen(f'https://bfmeladder.com/ladders?arena={quote(arena)}&gamemode={quote(gamemode)}').read().decode('utf-8')
    bs = BeautifulSoup(html, features="html.parser")
    users = dict()
    for tr in bs.find_all('tr')[1:]:
        tds = tr.find_all('td')
        rank = tds[0].text.strip()
        rate = tds[-1].text.strip()
        name = tr.find('span', class_='ladderUsername').text.strip()
        uid = tr.find('img', class_='miniProfilePicture')['src'].split('=')[-1]
        users[uid] = f'{escape(name)} {escape(rank)} ({escape(rate)})'
    return users


###########################################################


input_file_name = sys.argv[1]
output_file_name = sys.argv[2]
patch_name_token_1 = sys.argv[3]
patch_name_token_2 = sys.argv[4]
arena_uid = sys.argv[5]
replays_map = json.loads(open(input_file_name, 'rt').read())

map_names = dict()
date_max = None
date_min = None
records = dict()
for replay in replays_map.values():
    if not replay['IsValid']:
        continue
    if not (patch_name_token_1 in replay['PatchName'] and patch_name_token_2 in replay['PatchName']):
        continue
    if any([player for player in replay['Players'] if not player['FactionName']]):
        continue
    date_max = int(replay['Date']) if date_max is None or date_max < int(replay['Date']) else date_max
    date_min = int(replay['Date']) if date_min is None or date_min > int(replay['Date']) else date_min

    map_names[replay['MapId']] = replay['MapName']
    for player in replay['Players']:
        r = Record(replay['GamemodeName'], player['FactionName'], player['PlayerAccountUuid'], replay['MapId'])
        k = r.as_key()
        if k not in records:
            records[k] = r
        if player['IsWinner']:
            records[k].wins += 1
        else:
            records[k].loss += 1


records_by_mode = defaultdict(list)
for record in records.values():
    records_by_mode[record.mode].append(record)

usernames_by_mode = defaultdict(dict)
legacy_usernames_dicts = [
    json.loads('{"ec8f0c17-ef92-4b93-b6ac-a0267a52edf1": "Rak 1st (1283)", "a2ef3784-084e-43e7-a234-45970dbf9ec2": "NUADU 2nd (1270)", "4784df89-1a35-47c0-9e8a-07b829b441ce": "Priziv 3rd (1243)", "ae32120b-f3cb-4185-b1c6-05fef97d8d04": "Zira_aa 4th (1222)", "9b275b16-78d6-44e7-967f-eba896affc8d": "EMPEROR 5th (1215)", "235a70f0-0fed-4985-973f-e85f72e682a5": "BloodBorne 6th (1210)", "1df01908-e8b4-4d20-bd71-9bb4693458fd": "Underworld 7th (1197)", "54f8131e-4c85-41b6-8ddb-aed941f45d6b": "Veter 8th (1196)", "69756ff0-073f-4d62-b4bc-d6a4c102c0b8": "DK|Elessar 9th (1193)", "8027ea56-c81f-44f6-bb9f-7ca944d2c10b": "ARAMUSHA 10th (1190)", "5bab1584-4995-4657-bdea-47598eea5309": "DickObraz 11th (1179)", "7e19dafe-f24f-4242-99a2-376d5c24bfb0": "Black Myth 12th (1173)", "b0a27730-457b-4869-80f2-883648c887fb": "DK|Fabi 13th (1165)", "331736e8-1615-46fd-86e4-70f017515c86": "MIP 14th (1156)", "0cc1f78b-939a-4005-9ce6-d997cbdcd9a5": "WH |  ASALA 15th (1151)", "f50da527-004b-44c3-8fc9-521c9ae8f50a": "Smeargul 16th (1150)", "866ba720-6e6f-4458-85e6-8045b48a072e": "Conquest 17th (1143)", "93480aab-eb32-400d-9a9e-15ea56057906": "UZKON 18th (1143)", "bd7fcdeb-2c25-420d-9c62-1be19c4b9125": "stupid 19th (1141)", "bdec13f7-ba3b-4ea6-a9ac-d07c4f3d599e": "Maulwurf 20th (1133)", "6d7ed680-fe0e-4f04-8e7c-dc455d2d8f87": "Roshe 21th (1128)", "c9b520fa-139c-48da-a553-75c1cb0488d7": "Bilbo 22th (1126)", "3265ec05-54a8-46b8-a1ae-09419cb0c7ff": "Bobr 23th (1125)", "716f128d-2796-49f8-8ff2-32f9d8359ffd": "DM.Sedoy 24th (1120)", "352bf117-7e0b-43cb-b319-06f0214e8b4a": "Teh_Furamir 25th (1116)", "cf4fd133-8146-4a19-9303-0e14945ee8b8": "Alotes 26th (1116)", "4eed214c-61ba-4c73-bfed-c296b06ed020": "AtomNick 27th (1115)", "176003fa-7018-4097-a989-aa741c8c0915": "essik 28th (1105)", "2f9fc61d-b93a-40b3-8258-3d90c4558e73": "fatcat 29th (1104)", "41f6f76e-f9b5-43d8-893f-89464c18020f": "Mr.Rallitir 30th (1101)", "056eda34-f1b1-41f4-b71e-36263c3aff86": "Ivan_Ermakov 31th (1099)", "c9603d59-3937-4483-b3b2-f614e5084707": "Ooops 32th (1099)", "6fa89bd0-575d-4ba7-a4d6-c5b59a0a8947": "P o W e R 33th (1094)", "0ed4c890-0bb1-43e0-a1af-68b695976054": "gravet 34th (1092)", "852ec150-9852-4615-8bdd-65a628d95f59": "Manch 35th (1091)", "b07e54f5-05f8-48bb-b424-45f6921e3847": "\u0437\u0430\u0432\u043e\u0435\u0432\u0430\u0442\u0435\u043b\u044c 36th (1078)", "8b96f921-5456-4582-b49c-3fa74a280bf8": "ZLOLIZAVR 37th (1067)", "b9ef9a14-294f-4d48-a10d-d144babdd29a": "Did_Bad 38th (1063)", "51730afe-503e-4005-84e7-575deab7008c": "Werad 39th (1062)", "94faacf9-b789-4068-9e9d-f421b9e670c2": "Moon_Pony 40th (1061)", "6709b212-e901-4296-a138-0818102ab372": "finesse princess 41th (1058)", "97af8545-5055-49bd-b28c-8cba6f921931": "DKChika 42th (1056)", "e014c3e1-4b7b-403f-87a2-9905d98db249": "mustbe 43th (1055)", "da37f532-e553-49e6-802d-d24da377e22f": "Samkov 44th (1055)", "a8894a08-5b77-4750-a230-a47d267a72cc": "ingve 45th (1054)", "be013f22-2687-4544-a233-f78e352e92a4": "DG.Vestnik 46th (1053)", "8757d8b4-c6fd-4b49-9df9-e9b354454b66": "ICNiK 47th (1053)", "ab689556-e59c-49d5-b1e6-493223e10a1d": "X God 48th (1051)", "1232e992-362e-42da-9dde-931353ab0d0a": "1ce_05 49th (1050)", "8fd68888-9a4a-4acb-a6c9-444e73182b35": "[SotE] White Hand 50th (1043)", "de2a5ce4-8905-4d8e-a938-577a55866765": "Inquisitor 51th (1042)", "2dda741a-4a08-4aaf-896c-6ad98d7a6ad9": "Veronly 52th (1040)", "a509ad44-27fd-4b6c-bd5e-9d5a1c1c9c28": "Lev_05 53th (1037)", "1191932d-4830-435e-b7e1-c2e31e619698": "Takizava 54th (1037)", "d8b7ccea-a1fb-4764-9177-ee3471def659": "legal_asss 55th (1036)", "f38fc766-180b-4685-a3c7-4fe46f17e695": "Xertebe 56th (1036)", "86758c0d-b8eb-46f0-956c-7c24dd8050f7": "Muravishka. 57th (1034)", "27d76d40-0d34-4546-a44e-821824fda7fc": "Slash_JeS 58th (1034)", "480112c7-8ac5-41fb-b825-4927626816ff": "KaiVarta 59th (1033)", "ceeb1374-82de-4ed0-a68f-bd5d22867172": "Burdur 60th (1032)", "def4bfaa-0395-4906-b730-7e805ddc42cb": "nogavortu 61th (1032)", "d941912f-a8dc-4011-b952-5feabb146d06": "TRINITY 62th (1031)", "57c2b26d-9d97-4495-ae07-2892b23d64c6": "LezyOKI 63th (1031)", "aef90ba5-57c0-4975-9ed2-eee3b66d6251": "|Kurumir| 64th (1030)", "b68104d7-a9d9-4930-8cbc-023769d4d0ce": "gondorskiy 65th (1030)", "0d4984c2-893d-4d70-afbc-15b10694c0bb": "Strider... 66th (1029)", "06977b84-52a3-41a8-8eaf-8df3060648dc": "AEGOD 67th (1027)", "0e9d76a4-e7e4-4740-ab24-100a6e884eb2": "iamnoob 68th (1026)", "400ac8bd-b5d7-4741-b2b9-392fbbf14687": "westik011 69th (1025)", "88c36be7-8753-4199-ad1e-7781f2e7ae99": "JERRY [DI] 70th (1025)", "e4e68a46-b69b-4b25-b5c0-8557d482129e": "TurboFREAK 71th (1024)", "cef61524-6f03-4f65-bf1b-6842177d2a5f": "Ronyks 72th (1024)", "657891d9-0310-4bab-89f8-0785874a4b6e": "Esdeath 73th (1023)", "a5023775-199c-4b4d-91f5-e8d349e4aa57": "ddr67vrgtt 74th (1022)", "7d986c85-8e7a-4721-85ed-5b2597e9dabc": "HomePC 75th (1021)", "d5b383e1-0209-4537-a8bc-18b5b7f48631": "Wolmor 76th (1021)", "a5b3f4d1-9338-4dd9-83f4-afd0f1a4da57": "Elon Musk 77th (1021)", "b54165c1-cfc5-4650-8c15-42e2070eefa1": "anywew 78th (1021)", "b5e4dced-8a06-4045-8083-efd54f8e9428": "Zafrir 79th (1019)", "8aa66dcd-a91b-4c22-af56-1e01d633f9ee": "Loken 80th (1019)", "a0cce049-003b-4570-85f7-d14f4fce1154": "Denver 81th (1018)", "6eaa5bc9-7c9f-4416-ba92-27bc899fa871": "Randir 82th (1018)", "1c93d3fc-efaa-498b-b86b-19baa3f387a6": "Ratface 83th (1017)", "a1e5eb17-6c81-46a1-9eb9-c3b51e4625c8": "Lord_05 84th (1017)", "9e32f6a3-c070-441e-a3ca-d7dc7cbd098d": "VolnA 85th (1017)", "19ef2ec8-b113-40a4-8b2e-36f4ba1e2cd4": "ihorok 86th (1017)", "6db86d44-1d2e-4418-9840-17eee40e2f38": "BAKBAK 87th (1017)", "6ea490f0-7715-4f0a-ab16-6e4897f671b4": "RealBars 88th (1016)", "00160ed4-81c8-4476-8671-b53889c087d7": "SooS|Snens 89th (1016)", "7769a693-476f-48cb-8498-58fc454655f8": "Suslikus 90th (1016)", "654d738e-db03-4e2c-89a5-c88812c59ba0": "Maku 91th (1014)", "ad64f2eb-6486-46ce-8a99-5c60ba205e24": "n1k1ton1 92th (1013)", "356a247a-eb2a-4ea9-96a8-d4fbede1e828": "Uranus 93th (1010)", "92777962-641f-4b99-ac3a-90c75a6f8122": "^Kham\u00fbl^ 94th (1009)", "03f99c41-b18f-47bb-bd0c-c806620b4e3f": "eroned41 95th (1009)", "476488fd-56fc-4462-8dc8-ff108b63231e": "Zeratu 96th (1009)", "d7ed7dad-cdc3-4fa8-b98e-e4210c73c8c2": "Nimelia 97th (1009)", "c0e8ee22-9f94-47b2-8303-155f1e043948": "xUKEx211x 98th (1009)", "15b55122-34a6-4135-94d9-2e185ccfc730": "Elvis presly 99th (1009)", "0821f248-38d1-4063-975b-a432fad7e0d2": "Raxlyon 100th (1009)", "95828469-39af-4463-b9d1-2917dd2d9c48": "Galiaf 101th (1009)", "7d1cc890-ff13-4b43-a92c-6b89d6fd7d2c": "kartofel13 102th (1009)", "26cf9ae9-7b4a-48a2-8cb3-3938e85cde2d": "bocman 103th (1009)", "f5b9052a-7b26-4196-ae84-f9229a8f16de": "Azazello 104th (1009)", "9f79df2c-a540-4db9-b41f-8772385c43f5": "B\u043embadil 105th (1009)", "deb03d23-d256-4150-b815-bbbf910151dd": "Caesar 106th (1009)", "2773456d-5b47-4c12-bba0-2bd3ed0575c3": "Brim 107th (1008)", "09f8baa6-777c-4e44-8e85-86d750557857": "Kazak 108th (1008)", "0a255cab-8b3a-497f-8863-714a8d049337": "Snake-Eyes 109th (1008)", "8dac3660-e8f6-4623-946f-afa648d20e7a": "Carstein&#x27;s 110th (1008)", "4e492a22-dfe6-4646-b2e8-c4baf62fed9f": "SARUMAN 111th (1007)", "f46f0d3c-f607-4ca0-aef2-3a5f3f3058f8": "elonquest 112th (1007)", "ac40d5db-4af6-4030-8d85-d7b706be97bd": "Demiurge47 113th (1007)", "043caf5d-7fbb-413a-9d43-3d5f5e1d62a4": "Pele 114th (1007)", "00dcfe84-5593-4e60-9a54-755626abadd3": "relyz 115th (1006)", "e934e343-2e53-4fe3-a8a5-86c527e8b01d": "Rasul 116th (1006)", "fb998766-37a6-4d03-b3bc-9f49256dddff": "PhantomFear 117th (1006)", "3d57a6ac-ceda-4025-ba31-ba8da148b7b7": "CSM 118th (1006)", "9c923553-eb9f-4a13-b0eb-94d11d21a478": "raketa0 119th (1005)", "9b00e958-33f6-488a-ad58-b33aaf93ed33": "VOVA_VIST 120th (1005)", "80059b6e-8175-4147-bffc-30e94b79a631": "Halbrand 121th (1005)", "9fe94307-ca13-4e15-8c6d-024b1d6b5365": "Totesmeer 122th (1005)", "3e3a9d0c-0f38-4d95-95e0-64ca36c7d040": "VLADINGO 123th (1004)", "9348e9aa-a2dc-46bf-9068-a2715ccacbe7": "THRANDblCH 124th (1004)", "7d49c510-054d-47b0-b01b-50e0891e2c70": "WHshum93ik 125th (1004)", "25e97915-e1be-4ab2-96e7-d00d2b077411": "Adam Jensen 126th (1003)", "131aa888-c8ac-4fe5-ac2c-4af53e705fd3": "LeChapino 127th (1002)", "4b0c1a27-d397-4ffc-9e6c-022edb27f338": "Laichzeit 128th (1002)", "c0ca7cdf-e10e-4e98-bd17-6c9bee13988a": "Muzafar 129th (1001)", "a3b6ec35-1267-43df-ad5d-6cc8e5e90dca": "Dazai919 130th (1001)", "9ca563ab-726d-45dc-97fe-e66d27d5834d": "Smeagoll 131th (1000)", "15e34282-5964-48ea-9e2c-54e3ee1cc294": "Sixela 132th (1000)", "0cf91062-1c94-44f4-bb4c-2fcb81e65390": "Nutella 133th (999)", "f6368abf-154c-4a9f-8803-4dac66125a9f": "YBER 134th (999)", "b0703405-abea-475d-acc7-5de823c9af1a": "Mr.Mellon 135th (999)", "4be3034c-0f50-43e0-a647-e629dffd886b": "Liandri 136th (999)", "84db082b-ad39-4070-a525-595eac8e83f5": "Good 137th (998)", "34a6fc94-85ac-4946-b1ad-f14b51f41021": "Ardramalih 138th (998)", "a5d6c109-4182-4767-a545-71c9e5b5261d": "DareDevil 139th (998)", "8edf2e4d-9b66-4b65-b330-e9afd3f75997": "Wellboy 140th (998)", "83dc2908-1941-4222-b54a-8c4c051d6b62": "AzKaaL 141th (997)", "2fa00dd4-db2c-47dd-92c1-fd36324df437": "InsaneWonka 142th (997)", "961c5822-8a1b-474d-b2c7-07fc932cfba1": "Killer Skufov 143th (997)", "f3b95eee-b7f7-4440-bd0e-a77922b562ac": "Bronomir 144th (997)", "3ce2fc0b-55b2-4358-b3e7-eecb7fc8e6c6": "IIalbarad 145th (996)", "ed3ee58e-eff8-49d2-bd0c-2061998e56e7": "Temandil 146th (996)", "49408e6e-15ef-48fe-a4ca-2397b8fc21d6": "soldier 147th (996)", "f8a77fd5-78c7-4143-b889-e8a665628840": "KWT 148th (996)", "4f668f8a-5b03-41a3-b0ea-49225a2c7b77": "\u0421\u044b\u043d\u0421\u0430\u0443\u0440\u043e\u043d\u0430 149th (996)", "1dbd5777-18a1-4b27-a95a-825d3b3fc0e7": "SW_1397 150th (996)", "003f8fa9-d5a1-4678-b5c9-9f8f65057969": "ThinCat 151th (996)", "1629e27c-cc43-4be8-bea4-f42f8c71e950": "LavenderLe 152th (996)", "392b2411-3aec-4196-9148-cee9108beaba": "Povelitell7 153th (995)", "624d696e-fd09-45bc-86ac-64df4e0cedc2": "Mymak 154th (995)", "66153a75-7f76-4ea7-a7ae-c8ce95d8da89": "BeeDrilla 155th (995)", "5f99c973-300f-4f86-a11c-bbed028aff04": "_SULADAN_ 156th (995)", "0a3c8d7b-383a-4743-be06-012fb6c0daad": "PsiX 157th (995)", "4950cea0-65e4-4514-a0e6-596b258482ca": "Rubot 158th (995)", "29e52cf9-2905-40cc-82e8-4fa366f43bbe": "Salat00 159th (994)", "8aaeb475-6794-4b57-9cd8-8ad834c21486": "HaslfLex 160th (994)", "84bd7372-894a-42c5-bfaf-2b90f37abeab": "Lich 161th (994)", "3972bbae-3afc-425d-9459-b260a0827abc": "Brodobrey 162th (994)", "d31fbffe-f6e6-45fc-8be0-b9c658d5ddf4": "Austin 163th (994)", "9e0f6604-df01-4602-9a4c-998a40c0cde7": "LeoZealot 164th (994)", "23ad11f2-cc10-4f04-bd99-4d1b2e937187": "lakschuh 165th (994)", "bb1ca410-2333-4a09-8d77-be856511e9cc": "manderley 166th (994)", "117ffdba-18c5-4fa9-a3f9-867b585404ed": "RING7777 167th (994)", "a6483472-9dab-46d6-8a3d-306a01561b37": "QyzRe 168th (994)", "cfe58a2e-329e-4b28-8502-b79f62c7cfb9": "Protos 169th (994)", "9245fb48-6a9e-43fb-8d24-d49443f29b42": "R_Man 170th (994)", "0525c295-a36e-4d6f-880e-ebce4bb2545b": "Kyagara 171th (993)", "f18e8f76-c3d1-4658-b957-12f0396f5c3e": "UnsainteD 172th (993)", "3994d90f-3305-4d08-a11b-330b0b461519": "18Pioner23 173th (993)", "707641b1-6017-480f-b29a-596b770f63a8": "DAGAZ 174th (993)", "427b8305-35f7-4bbc-9d44-1319d396b1c6": "AlleEhreJesus 175th (993)", "05a78a1b-b729-4372-98c5-86d98b92808a": "zatonoichi 176th (993)", "b27c6dd2-77fa-4705-ac18-862ffff4de72": "Smayg 177th (993)", "15a7505f-6f6d-44d7-a5db-bb659e8236d5": "Ktskkk 178th (993)", "b1c6242f-97d8-4d7f-964b-ab69f5d1469f": "Callafiori 179th (993)", "cae58856-4a30-4f07-8b50-7424e500fe14": "Janikderzerst\u00f6rer 180th (993)", "963dfd67-76fe-4f42-b176-842a9db07abf": "Alfasamec 181th (992)", "dda8b910-07f9-49fc-abe2-410ccdf9ec2d": "CTALIH 182th (992)", "440424ba-8e59-4bbb-8cd0-30ec7f882d1d": "Gman 183th (992)", "5d4982f3-537f-48b1-8885-7b1bc12a2b4b": "_Fortuna_ 184th (992)", "049b3f7c-9d45-410e-b0ae-c7667f4380b3": "Boreotoriks 185th (992)", "3c9241d3-cabc-43be-b7ea-9f925defb6ae": "Dida 186th (992)", "e3bbee1a-5010-45ec-a7c9-f808729d1ea5": "Dared 187th (992)", "fe7486f2-e282-48ca-946a-e58e54289310": "kramkramich 188th (992)", "f62c8b1e-ebd9-4fca-98f8-3caf22661073": "Voevoda_REKSS 189th (992)", "c1d3a5f6-b5f9-4101-9ab2-4d81eafb3c7e": "Brechstange 190th (992)", "06ee21f9-7fd6-4305-b897-dfeb28190a85": "KAPON 191th (992)", "ef90c8ec-119e-4639-8aff-4fa6f8805313": "Davnik 192th (992)", "43375e2b-a81f-489a-b773-1aa07930e365": "nikolaj123 193th (992)", "5a88e9d6-91fe-4932-a97c-f4b9022ad947": "Slim 194th (992)", "a6fbcace-7be2-4709-b29f-b7ddd9f4b509": "Rogueassasin132 195th (992)", "4b51439a-d056-4d0c-90f1-a6198ef729b5": "\u2020SLy^Crow\u2020 196th (992)", "21b792e1-7814-4458-8400-762c0158fc12": "Disslaman 197th (992)", "db8b791b-b909-4411-846d-9d5d549a2e56": "ArEs9955 198th (992)", "ff6ed64a-0493-4779-9f7b-fc53bb5fd6bd": "Vekar 199th (991)", "3ed8f5d6-332a-4f8c-9bcb-e8f88f5107aa": "Zopich 200th (991)", "2995a1ba-c226-4f4c-ae0c-8ebf049bab03": "R8sseauu 201th (991)", "cf89dd0c-a610-4d68-bc47-4dea500fae32": "karifito 202th (991)", "0a707b60-0510-462a-b73b-76c964168436": "irekson 203th (991)", "f6431800-a842-4755-83e9-cdf099f75888": "Syrok 204th (991)", "547b735d-8430-4cd0-a235-60c0deda7563": "maximilian 205th (991)", "0a58f863-deb0-45c4-8d46-f071f6a934f2": "Vatson 206th (991)", "95aa811c-66ae-49b9-b0cb-74d5c2e4bafd": "aksenov_91 207th (991)", "7f5dfe24-5a53-4a3f-990a-dda67771516b": "helmdubo 208th (991)", "0d4f80e2-1e17-44c1-a0f5-34ce8a22f667": "AnDmiEn 209th (991)", "4cabef42-f570-45ff-bc27-d21c20c7b378": "mikaeljan13.90 210th (991)", "d6cd3b55-05f0-4117-84d2-e28ebe4a3b51": "Azoger 211th (991)", "f12e8dd7-9266-4ac3-9406-04eb358c4002": "romasan 212th (991)", "4a54d561-45b5-4cf9-8122-a8db72e791bd": "Lex_Kobalia 213th (991)", "30139d48-9699-4e33-b9d0-7a549bed080e": "freedomknight 214th (991)", "9d786fe6-60fc-47f8-8904-d304a192dd2a": "LiWan 215th (991)", "ac51502a-7689-46c4-a8d1-3ebdc28c2c96": "MIRAKURU 216th (991)", "c5d9911c-3dbc-4094-aca9-26e105e2caa4": "AiR 217th (991)", "a6a07347-4028-45ef-9aea-2d3dc4052019": "Britney 218th (991)", "bcd952dc-1b04-4c77-8614-db9c17e792b8": "Snop1k 219th (991)", "841c0159-413f-4ba9-b4c1-9eaf06ffd50b": "anticlown 220th (991)", "0e336532-478c-472b-a744-b92c9dccb619": "Kirill19792003 221th (991)", "2350bf3b-6454-4dbb-a6df-2a306f992136": "mr.Anderson 222th (991)", "f6e0c957-146a-4f3b-9e10-1068f9198c29": "alxdolskiy89 223th (991)", "852a22b1-4be3-460e-ac24-9167c0126042": "meda 224th (991)", "83cef8c8-ce8f-411b-aba1-7a5b8f2f141f": "\u0418\u0448\u043e\u043d\u043a\u0443\u043b\u043e\u0432\u0421 225th (991)", "aa3a6caf-f5cb-42fd-be93-c653d5579f82": "grimlord 226th (991)", "f16c3678-9411-42cd-9ec0-a1757724e080": "Emin 227th (991)", "53e53122-aa46-4e52-95eb-0bcfa9496cb7": "\u043a\u0440\u0438\u0432\u043e\u0439 \u0445\u0443\u0439 228th (991)", "42ce8bfb-8b10-4da3-af49-d72750e2ee2e": "Salliseth 229th (991)", "f19ec730-8f9b-4932-a8e4-b0956140b03d": "ded0moroz 230th (991)", "1d7168a7-f111-4090-afe9-697ea248ab8e": "Halbrand` 231th (991)", "7526e0dd-874f-44ea-88c3-3b00af2d19b0": "dast 232th (991)", "b01be8f6-c018-4bc9-b81b-57e8dd6687e5": "Ros\u0451 233th (991)", "d4939e1a-c379-4ddb-b013-5ae5a7a3ea3c": "GGrey 234th (991)", "f75ebe7a-9711-44cc-8719-431ad4dfa220": "legenda 235th (991)", "52164bbd-d1b1-46d6-9481-0198cad3d173": "FuzzyLane 236th (991)", "addd2ac5-736d-4165-9d6e-08f75698a7e5": "\u0421\u0430\u043d\u0451\u043a 237th (991)", "61295751-4841-46c1-8977-15ea3b02a1c4": "craymon 238th (991)", "7f65fd26-5bb9-4b4a-8d74-a0d6b1bcaeb7": "__CYXAPUK__ 239th (991)", "be6bb51b-03aa-4986-92d4-947dcb9a9e1e": "Aksus 240th (991)", "2534b458-c8ce-41e8-b78b-85634f9a37a0": "Stankovic 241th (991)", "41ac1bbc-de21-49be-92ab-333d89a65244": "HONOR 242th (991)", "172bb377-8372-46ed-bf82-245abcae40d5": "Manven 243th (991)", "91f1b4fb-22c7-4a32-a16b-2526d960b1ad": "_N_O_D_ 244th (991)", "78afb056-7035-4529-8f53-583556383f2e": "SamStatist 245th (991)", "e6513d3d-e5ff-42ce-a6fc-27d5674a5257": "HohotSheptuna 246th (990)", "248c7ff5-414d-45e8-ab6e-40f68ae07ca7": "krekerr 247th (990)", "548108cd-e460-40f0-bc95-f80453c97113": "Kortes 248th (990)", "f2b872b0-003d-4324-8d48-5ec24a8f6bbc": "SmokeyCheetah 249th (990)", "56d94614-f4cf-4496-b52c-6e4ae0a15803": "kevan759 250th (990)", "9be9dee1-0c1e-4e92-9500-9526a2899dff": "valbalbuster 251th (990)", "a73e9516-395e-4874-ada3-b04105e4b6a0": "Perosus 252th (990)", "7f882925-ecd8-46a0-83cb-afbfa9b90a5f": "APEX_BFME 253th (990)", "3a964078-0e6c-40f1-8be7-e39809955337": "aaaaa 254th (990)", "d4e2c64b-a189-46e3-8a6e-e3a76590984f": "Udav 255th (990)", "40fc63bf-c53f-42e1-a19f-e0ce055ce916": "Operator 256th (990)", "6b0dcc8d-d6de-4147-bec0-f4789980b8c6": "M-Ali.Momentali 257th (990)", "632e4cb9-0a2f-4178-a557-a3437f565c51": "Kratos12 258th (990)", "515b7c33-f93e-4772-99a4-78e55f972af8": "\u0417\u0434\u0428\u0440 259th (990)", "154dd1c3-0ecf-48e3-9381-0f6fd5587612": "\u0425\u043e\u0442\u0430\u0431 260th (990)", "ba98bcb0-fb5e-4fa0-bc38-8b045b6d4ac7": "maga928@ukr.net 261th (989)", "f46072b3-3b4f-467b-ab7d-788fca72d129": "Vitoskokos 262th (989)", "e8ab4fcd-9523-4933-8d79-f7eddb6d9572": "Bull 263th (989)", "42cda512-5fe1-4add-8314-823457fc3fc3": "NoobAss 264th (989)", "e9c45a67-24ca-41d9-974d-457fa31b941a": "HephaestusTD 265th (989)", "4a8d88ee-4b2e-4b10-b6a0-9414474d0266": "AsukaZY 266th (989)", "728043fd-df40-4f18-a612-7b13a70b1c72": "Maksz5 267th (989)", "b0564413-fed3-4976-bd09-fa6537edb6c8": "Elarion 268th (988)", "98b19229-d9b8-40ed-a7d0-b7a5057fcb40": "GLADARK05 269th (987)", "0c996483-3584-4142-8f70-80c395897316": "Mr_Shelbi 270th (987)", "47d61eb5-b289-43c1-8c58-ffc30e7a75a5": "\u041a\u0440\u0435\u043f\u043e\u0441\u0442\u044c 271th (987)", "aa27cbde-8613-4866-86ec-a44e5c55bdf9": "SAMCHAY 272th (987)", "63e5c335-e111-427e-ba72-f5c4686ed42c": "MaikS04 273th (987)", "15f8f633-e965-4b8e-b967-6d210ea385bb": "Alexxxey 274th (987)", "17032224-4ef8-446b-a220-d3f4b0cb809a": "DG)WOIN9 275th (987)", "34f8a2d7-6333-42de-b41d-770971e93ea4": "NoltaR 276th (986)", "ab2685eb-063e-4aa2-9534-9d6edb23e406": "CAPYMAH228 277th (986)", "4abe3cec-97e4-49b2-b72c-164804383f11": "DUKE ROLLO 278th (986)", "877f26b1-eaf2-40d1-81c5-233cedca0df3": "Ravencar 279th (986)", "4cf5a5b4-1240-4fc3-b351-94dac1ab2bbb": "Goldenfold 280th (986)", "cabe51e9-6cd5-4038-8d7a-e109102b446e": "Bac9.B.Nike 281th (986)", "1579b5ee-f244-4166-a5e2-97fc657673d2": "TheAlex 282th (986)", "66926dc2-125f-46c7-80d1-d03aa1424c68": "Gafar 283th (985)", "0e6eb009-a1da-498c-bf7d-c46d15de5092": "Vigge 284th (985)", "11c0579d-9991-4135-a118-66c32bfb4e00": "Chelovek 285th (985)", "93a26f90-af0b-4f1b-bb67-aad27400ec39": "DeimaN 286th (985)", "e95dbca4-7b95-4ddd-8fff-69d32c0f2baa": "brunoss701 287th (985)", "d25846ac-abc9-4550-a94e-4655db1168d9": "Paha 288th (985)", "fa3580d5-97a7-41b1-a78f-92c49f47a44e": "SooS | Yolo 289th (985)", "df0ff691-3d48-4219-b687-1ccd1cf69cfd": "Elvo 290th (985)", "138b7b6f-56ed-4416-b0fa-1dae3939c5af": "Mafel 291th (984)", "2e7c7e42-8a46-4a5f-942c-dd7036a4c9d0": "Xeld 292th (984)", "b188b692-8cb0-4bc7-a8bd-40aba00b441c": "Rebells 293th (984)", "3c214189-d7f5-4f8d-a351-c66f35186c1d": "Grosis 294th (984)", "a6aa51d4-f0c4-4f76-a277-59bc76a54447": "Konstantin 295th (983)", "733d6ce0-0199-4147-9e6e-efd2d0414259": "TheJ0llyRancher 296th (983)", "5e2ebcaa-1dd7-4e52-8456-d75617de159a": "Illunt 297th (983)", "766223aa-fc4b-4610-a2c8-e4c1b4fd92d2": "F_a_o_d 298th (983)", "eddfe952-412f-478f-846f-78cb28b3e6d2": "viuviuviu 299th (983)", "eef052b3-ed8f-4a5f-8d41-c28619df6884": "VeNoNoM 300th (983)", "bb55f924-943a-4006-8ff3-76cf38f1d8c3": "ShiBuraddo 301th (983)", "7c30757c-1e9f-453f-a4f2-45868a7c09a5": "babelgam 302th (983)", "bffe979b-e145-4096-b378-ac9dee6fdb31": "EDDOS 303th (982)", "0c882b0a-3bbc-4c46-8903-907013c73d36": "wyir 304th (982)", "ed204126-20df-4c68-a49f-2813c17c56e0": "ivonavi 305th (982)", "155ef3fd-390b-4d8b-b1cd-5fa44f6be8b0": "Cezare 306th (982)", "3ec90fe0-8c31-42ba-b42d-ce4c343d7356": "LoveHentai3 307th (982)", "965987b6-1b7e-4980-ac93-195ca9088593": "Chloe 308th (982)", "fc896f15-1d63-44e9-bd7c-8a6c80f190ad": "Sargon 309th (982)", "ed2ea846-06b7-4695-998b-dc9e5f171e2f": "NikolasKas 310th (982)", "4e489239-6d75-4069-832b-04eadb61ca73": "Monolith 311th (982)", "b01f7dc6-c24c-49bd-a1e6-a7fc125f80de": "Xnum 312th (981)", "af1a7e99-16c7-48a9-9850-e34ef2aacba8": "DEQWAZ 313th (981)", "a806ff98-eace-4807-beec-9b8c2a9c13c7": "Ulf Hviti 314th (981)", "ea81a8d4-84e1-4797-8c22-8cc39bd4de47": "Mefrit 315th (980)", "1ffb961e-7cb1-4580-9dfd-91ccfd367cbb": "Inzukan 316th (980)", "5d966658-0846-4822-aef9-7ac93a417ba9": "Nesisyuda 317th (980)", "88918f1d-6232-4eee-be34-9e234eb7de9c": "Snoopiks 318th (980)", "14da2e91-a3e8-4180-a2f5-f7ffcec6edf8": "AnTiDoTeR 319th (980)", "69e9d8c3-65e9-486e-a3d9-3163448fddb4": "pomidorka 320th (979)", "f04868fb-8184-4d5e-8e50-4884a77277b4": "KANADA 321th (979)", "6273ca00-edab-4037-970c-4c23c800628e": "Kill-Joy 322th (979)", "d65ffdfd-1c35-48c0-9168-25110ce14ba0": "Darth Revan 323th (978)", "15e54a12-6aa8-45dd-9fbc-b8bf1813b0b1": "Zibo 324th (978)", "28459ebc-b5a7-4e86-85d6-5ac77d037334": "Botanic 325th (977)", "2ffe8088-9ac5-4bfc-92ac-829f6345330a": "Zuzu 326th (977)", "46908eec-0a90-4287-8ca9-acd2e3786278": "Lxthar 327th (977)", "3276749e-5764-4ce9-baf4-b80c530b5a49": "kasel 328th (976)", "cc0739ea-44ab-4195-8873-e1e36442e9f3": "KlementinV 329th (976)", "0743bc5b-7a7c-45eb-8a2d-f6a9ffc4ede7": "Veles 330th (976)", "b68eb0be-f358-4976-9d64-7ed5a7c84bc3": "HaradeA 331th (976)", "ae46004e-5bb7-4388-aa3b-ebc1a90ac61f": "vlados 332th (975)", "42e82ad4-cabf-45d0-8904-6dd46660e8b7": "XXXXXXX 333th (975)", "09eda0e1-66f2-4c1f-858f-a387b159e10f": "Lafi 334th (975)", "11673314-d3a9-4ec0-8a0c-b7e32101040f": "Xristos 335th (975)", "3d524f6c-09c8-4b6d-93b5-f88fc4a4affc": "DRAGON 336th (975)", "3c3440ff-9a12-43ec-88e9-5f6826c3c228": "battlebee 337th (974)", "191c2a99-f1cd-4470-8dfe-196a340d7684": "bro 338th (974)", "07fc8915-7620-4d57-b2e7-d2cac5bdd189": "EvGeN 339th (974)", "25e5a3ae-8260-4918-92b1-0b196ee2cd95": "(WH) VASIANpro 340th (974)", "7d2b19cd-92c7-4383-b503-1f2d13aea9d0": "Gergut 341th (974)", "5e85c87d-9117-4465-827a-d4d6ec64fa24": "Saze 342th (974)", "e65885c7-b8e8-4922-b94e-a5e0e5a71077": "Luniz 343th (974)", "c2ecc4bb-6fa5-4258-b0e7-a320e0935855": "Tigr 344th (974)", "b3502136-f7f7-4394-8b32-8ecee52a5f5f": "irebdiev 345th (973)", "d12e9e18-db77-4f69-9cda-0684460b1721": "kaiserhoff 346th (972)", "cae532f7-8116-4fee-80da-1761dff8f97b": "Magisterrr 347th (971)", "39bb635f-dc2f-48bf-a6b1-927e8d975306": "moks07 348th (971)", "8d23909a-307e-44bd-a34b-7ccba84ed5cb": "Polontir 349th (970)", "cc4ff70c-3fa9-4a1f-a630-f7765d863bb3": "malar 350th (969)", "9c14f35b-0225-4648-bbe8-6883546b6999": "Fidji 351th (969)", "075e8395-f7ba-4a1c-ae53-e0c08ab98afc": "MM.grey  fox 352th (969)", "dbc05bf2-6b59-4d33-aed4-3f61ebc20c2a": "Bluetowhite 353th (969)", "476da45e-3a17-4c0a-8e6d-6e2d7f759746": "Belong 354th (969)", "d3b4a4db-3f5f-493f-a520-6ba5353b9603": "WHNote913 355th (969)", "dae2e872-4677-4120-a5a9-95bf6b227d80": "Soul Reaper 356th (969)", "5aaf6298-fbb4-4081-8689-488474481302": "Ebatel 357th (969)", "614cb0ed-5438-4652-8c39-e47b116de0d5": "Oz 358th (969)", "435a82ce-7eb6-43cc-b8c6-b740b5a70d6a": "Graf Maga 359th (968)", "91c3e68f-3401-4b81-b3c2-70888eeee219": "Crol 360th (968)", "6d128a67-2972-4c32-9038-87ad9cf90a3d": "EdainUnchained 361th (968)", "2f895a64-4e07-4b7b-af22-ea37fa4c8682": "Skalleto 362th (968)", "66f022ca-3d1c-4802-8a5e-bb35397af94c": "|SE|Jonni 363th (967)", "4e6d4895-74e6-48ac-bd8e-4f1070a64e8a": "R\u0430gnar 364th (967)", "6addf6d1-3a1d-412f-aafe-8f37e91f483b": "gamer 365th (965)", "2a69f024-fccb-45cf-b3bc-1b95a0610da2": "rokfeler 366th (965)", "3ee1abf6-c1d2-4cf8-b9fb-8cd8a5402f5e": "BARIK 367th (965)", "b88e6ca2-aae5-4fa6-8b70-6cea3ea04a36": "Zako 368th (964)", "ab48304b-6b1b-4033-9223-b32aeb0ec370": "Givi 369th (964)", "554cc77b-8d80-421f-9dde-ea7113bb668b": "MMbobrule 370th (963)", "efe996cb-5669-46f5-8483-0011b8f47b25": "Drokson 371th (963)", "a0363ce6-8ad3-4246-83a8-f46140f9688f": "Expireans 372th (963)", "badd0ebb-3e15-476a-8c0d-d3279d22b199": "FiCus 373th (962)", "37697fa7-0045-4491-a9da-652aaa135c76": "Danmagor 374th (962)", "2fee85e0-5769-4489-98d2-049a8e7d4d42": "Vanquished 375th (962)", "10dc4961-ef64-43bb-ae1a-54d4c41be661": "sky00 376th (962)", "b622eb9b-8ec0-433e-bb4c-81419756d743": "ICVladlord 377th (961)", "01831290-b356-454b-9651-914afc5002bf": "Novichok 378th (960)", "eca906c3-301f-4a88-ae9a-ee77c88afb0e": "Xorti 379th (960)", "fb04d560-76c6-469a-a74e-33a437c5da89": "\u0415\u043d\u0430\u0440\u0430\u0442\u043e\u0432\u0435\u0446\u044c 380th (959)", "bae32176-8811-4d5d-aab0-8c7cd0059e9b": "Grumpig 381th (959)", "f282a8c7-e791-4e72-92fa-19f9366f336b": "ShahSamani 382th (958)", "1c4dd5c2-030b-400f-b745-e1801078e085": "Bugor 383th (958)", "925befdf-c05d-4363-8f20-e6f6455c6823": "Pars1val 384th (958)", "1f837ff5-312f-4b7c-a1ec-6b28f9b759fd": "march 385th (957)", "930e4d3d-5598-489b-8266-8fab6692c5fb": "serand2 386th (957)", "fe4835e1-5a4e-4e24-92b2-fb20fe1a0637": "Vadi 387th (957)", "c9ac9e79-6056-4ce0-97d0-8fcb8149fa70": "illegalkd 388th (956)", "4469bed3-a816-4630-bb6a-b14063608656": "Ruslan_1 389th (956)", "161d4848-cebb-4a6e-922f-494427e243fb": "W8&amp;BleeD 390th (955)", "4c4cb1dd-6a3a-49f9-9428-be2868e0e56f": "Myrza 391th (955)", "a5db6df2-876c-4e7d-8eca-b8cc49d862d5": "BILY XERINGTON 392th (955)", "ab5f5ef8-e467-47b5-95d1-0a57b03865bc": "bolg 393th (954)", "769de38c-3dd8-467f-98b2-1377dc685b5f": "Gay Dragon 394th (953)", "173d0117-edfd-4f6e-9a5a-61f029f2d92e": "Vulgarny 395th (952)", "0c6ae7e4-3c66-44cd-b897-bfcdae44abc1": "GRIMM 396th (951)", "1239d799-c156-4b89-a6c0-6957b8d5cf47": "Xolodnik 397th (950)", "7b290edc-87d7-4879-aaef-0502034a4732": "N3ssaj 398th (949)", "7fe0a846-b1d1-4f55-bd57-69927cd4a77a": "noobs 399th (948)", "99be56c1-93ef-4567-81e2-3cb762dc146e": "Belavis 400th (948)", "80b6e6e8-4e8d-4d07-98cc-0e3054f02bb2": "Wishmaster 401th (947)", "ee9cb637-2804-4814-99a1-d83b9b460fa2": "Gor8 402th (946)", "1f87283e-31f7-41cb-940a-a0714f3f5535": "Dizeel 403th (944)", "a1720bf1-ddb0-4036-9bf9-86b0d897fa60": "Counterspell 404th (943)", "12d27c8b-6560-4223-91ea-26b8361f2eb5": "Vesemir 405th (940)", "f26a8a69-e739-4576-853c-54de7e619063": "\u042f\u0440\u044b\u0439 406th (937)", "1b675f5c-5824-46cd-aac5-996c5c29a768": "Gas21 407th (936)", "84382620-850c-4f13-9f14-29319357c9c0": "Mixfix121 408th (934)", "f22c3122-773a-4017-84eb-ee707fe2b1aa": "kaktus001 409th (933)", "9a69a39a-5bfd-4843-a450-01ef148ca7a6": "Smuggler 410th (932)", "c67717c3-dd5c-4525-8925-b04bedc9566b": "lottor27 411th (932)", "cc042695-6141-4e66-a90f-31a77e4de037": "Valar_Orome 412th (932)", "59d42081-4c36-499f-b12b-fb86f3ccfce1": "arriva 413th (930)", "0cd13375-ea00-4ba7-ad4c-935428388b8c": "MiGamer 414th (929)", "f530f54b-b0d2-4d59-8087-bcd68952eaa0": "Makvin 415th (928)", "8689f82b-8746-4447-a7d2-023e5eaf51bc": "ROMULUS 416th (927)", "4b11def4-153f-4837-9814-8853340540b6": "Hesam109 417th (927)", "bca9e479-a015-49b8-aab9-59a86fdcd3c6": "Dven 418th (923)", "0fc3d8e9-25cc-4e12-8d7d-3565d59f19a5": "ronin0299 419th (922)", "95ff10b5-9d30-414c-ad81-a5a84b0fe5c4": "aladman 420th (922)", "3cd45b04-60c3-4fe7-a816-287c83a20c9a": "\u0421\u043c\u0443\u0437\u0438\u041a\u0430\u043c 421th (917)", "84ea3701-925e-460e-bea3-7cfac38ea32a": "Alex West 422th (914)", "bc2e0336-fa4c-4721-8e1a-1f7b4631a0c1": "Kuldur 423th (913)", "b53a6162-a957-485b-981d-befba6b363fb": "WHdartponi 424th (913)", "6fa43043-d3c7-467d-9682-8b0fe5abf31a": "Helm 425th (912)", "4ee24c41-dbe7-4616-80a3-b9234260461a": "ROSTrOHAN 426th (912)", "5840ec87-4d24-4a3f-abfe-4e90314b4a19": "godworker 427th (903)", "e6d74ac3-cb70-406d-ba3b-3ffb8046b226": "Frank 428th (903)", "dcf30ec1-3c2d-470a-8d74-2ca8ab1c0953": "irebdiv 429th (892)", "0467aba1-6205-4c80-a834-249b5a34d346": "Smelocmb_2024 430th (891)", "d9c20ee3-0c66-4e82-8955-89c547825a44": "nebo97 431th (879)", "ee59b8e9-3466-4236-bbfc-65104899c0f6": "PeriUtkanos 432th (874)", "f1ee260c-59b4-4047-8e4a-c904ad8218f4": "TvinkolToss 433th (862)", "c506f03c-5d72-48e0-83bb-20a9499e7fac": "Vincent_66 434th (848)", "060c3abe-9acb-4bfe-af90-4d6b48073fd8": "Script 435th (847)"}')
]
for mode in records_by_mode.keys():
    usernames_by_mode[mode] = gather_user_names(gamemode=mode, arena=arena_uid)
    for legacy_dict in legacy_usernames_dicts:
        for k, v in legacy_dict.items():
            if k not in usernames_by_mode[mode]:
                usernames_by_mode[mode][k] = '(old) ' + v
    for modeRecord in records_by_mode[mode]:
        if modeRecord.user_uuid not in usernames_by_mode[mode]:
            usernames_by_mode[mode][modeRecord.user_uuid] = modeRecord.user_uuid

date_min = datetime.datetime.fromtimestamp(date_min/1000.0)
date_max = datetime.datetime.fromtimestamp(date_max/1000.0)
if output_file_name:
    open(output_file_name, 'wt').write(json.dumps({
        'date_min': str(date_min),
        'date_max': str(date_max),
        'mapNames': map_names,
        'data': [{'mode': mode, 'userNames': usernames_by_mode[mode], 'data': [r.serialize() for r in modeRecords]} for mode, modeRecords in records_by_mode.items()]
    }))
